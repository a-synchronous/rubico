/**
 * rubico v1.9.1
 * https://github.com/a-synchronous/rubico
 * (c) 2019-2021 Richard Tong
 * rubico may be freely distributed under the MIT license.
 */
const noop=function(){},isPromise=t=>null!=t&&"function"==typeof t.then,funcConcat=(t,r)=>function(...n){const e=t(...n);return isPromise(e)?e.then(r):r(e)},funcConcatSync=(t,r)=>function(...n){return r(t(...n))},objectProto=Object.prototype,nativeObjectToString=objectProto.toString,objectToString=t=>nativeObjectToString.call(t),generatorFunctionTag="[object GeneratorFunction]",isGeneratorFunction=t=>objectToString(t)==generatorFunctionTag,asyncGeneratorFunctionTag="[object AsyncGeneratorFunction]",isAsyncGeneratorFunction=t=>objectToString(t)==asyncGeneratorFunctionTag,pipe=function(...t){const r=t.pop();if(t.length>0)return r.reduce(funcConcat)(...t);let n=noop,e=noop;return function(...t){const o=t[0];return"function"!=typeof o||isGeneratorFunction(o)||isAsyncGeneratorFunction(o)?(n==noop&&(n=r.reduce(funcConcat)),n(...t)):(e==noop&&(e=r.reduceRight(funcConcat)),e(o))}},pipeSync=t=>t.reduce(funcConcatSync);pipe.sync=pipeSync;const isArray=Array.isArray,promiseAll=Promise.all.bind(Promise),funcAll=t=>function(...r){const n=t.length,e=Array(n);let o=-1,i=!1;for(;++o<n;){const n=t[o](...r);isPromise(n)&&(i=!0),e[o]=n}return i?promiseAll(e):e},always=t=>function(){return t},__=Symbol.for("placeholder"),curry3ResolveArg0=(t,r,n)=>function(e){return t(e,r,n)},curry3ResolveArg1=(t,r,n)=>function(e){return t(r,e,n)},curry3ResolveArg2=(t,r,n)=>function(e){return t(r,n,e)},curry3=function(t,r,n,e){return r==__?curry3ResolveArg0(t,n,e):n==__?curry3ResolveArg1(t,r,e):curry3ResolveArg2(t,r,n)},objectSet=function(t,r,n){return t[r]=n,t},funcObjectAll=t=>function(...r){const n={},e=[];for(const o in t){const i=t[o](...r);isPromise(i)?e.push(i.then(curry3(objectSet,n,o,__))):n[o]=i}return 0==e.length?n:promiseAll(e).then(always(n))},curry4ResolveArg0=(t,r,n,e)=>function(o){return t(o,r,n,e)},curry4ResolveArg1=(t,r,n,e)=>function(o){return t(r,o,n,e)},curry4ResolveArg2=(t,r,n,e)=>function(o){return t(r,n,o,e)},curry4ResolveArg3=(t,r,n,e)=>function(o){return t(r,n,e,o)},curry4=function(t,r,n,e,o){return r==__?curry4ResolveArg0(t,n,e,o):n==__?curry4ResolveArg1(t,r,e,o):e==__?curry4ResolveArg2(t,r,n,o):curry4ResolveArg3(t,r,n,e)},asyncFuncAllSeries=async function(t,r,n,e){const o=t.length;for(;++e<o;){const o=t[e](...r);n[e]=isPromise(o)?await o:o}return n},funcAllSeries=t=>function(...r){const n=t.length,e=[];let o=-1;for(;++o<n;){const n=t[o](...r);if(isPromise(n))return n.then(funcConcat(curry3(objectSet,e,o,__),curry4(asyncFuncAllSeries,t,r,__,o)));e[o]=n}return e},fork=t=>isArray(t)?funcAll(t):funcObjectAll(t);fork.series=t=>isArray(t)?funcAllSeries(t):funcObjectAll(t);const objectAssign=Object.assign,assign=function(t){const r=funcObjectAll(t);return function(t){const n=r(t);return isPromise(n)?n.then(curry3(objectAssign,{},t,__)):{...t,...n}}},tapSync=t=>function(...r){return t(...r),r[0]},thunkifyArgs=(t,r)=>function(){return t(...r)},thunkConditional=(t,r,n)=>t?r():n(),tap=t=>function(...r){const n=r[0],e=t(...r);return isPromise(e)?e.then(always(n)):n};tap.sync=tapSync,tap.if=(t,r)=>function(...n){const e=t(...n);if(isPromise(e))return e.then(curry3(thunkConditional,__,thunkifyArgs(tap(r),n),always(n[0])));if(e){const t=r(...n);if(isPromise(t))return t.then(always(n[0]))}return n[0]};const catcherApply=function(t,r,n){return t(r,...n)},tryCatch=function(...t){if(t.length>2){const r=t.pop(),n=t.pop();try{const e=n(...t);return isPromise(e)?e.catch(curry3(catcherApply,r,__,t)):e}catch(n){return r(n,...t)}}const r=t[0],n=t[1];return function(...t){try{const e=r(...t);return isPromise(e)?e.catch(curry3(catcherApply,n,__,t)):e}catch(r){return n(r,...t)}}},thunkify3=(t,r,n,e)=>function(){return t(r,n,e)},arrayConditional=function(t,r,n){const e=t.length-1;for(;(n+=2)<e;){const e=t[n],o=t[n+1],i="function"==typeof e?e(...r):e;if(isPromise(i))return i.then(curry3(thunkConditional,__,"function"==typeof o?thunkifyArgs(o,r):always(o),thunkify3(arrayConditional,t,r,n)));if(i)return"function"==typeof o?o(...r):o}if(n==t.length)return;const o=t[e];return"function"==typeof o?o(...r):o},areAllValuesNonfunctions=function(t){const r=t.length;let n=-1;for(;++n<r;)if("function"==typeof t[n])return!1;return!0},thunkify2=(t,r,n)=>function(){return t(r,n)},nonfunctionsConditional=function(t,r){const n=t.length,e=n-1;for(;(r+=2)<e;){const n=t[r],e=t[r+1];if(isPromise(n))return n.then(curry3(thunkConditional,__,always(e),thunkify2(nonfunctionsConditional,t,r)));if(n)return e}if(r!=n)return t[r]},switchCase=t=>areAllValuesNonfunctions(t)?nonfunctionsConditional(t,-2):function(...r){return arrayConditional(t,r,-2)},symbolIterator=Symbol.iterator,MappingIterator=(t,r)=>({toString:()=>"[object MappingIterator]",[symbolIterator](){return this},next(){const n=t.next();return n.done?n:{value:r(n.value),done:!1}}}),NextIteration=t=>({value:t,done:!1}),symbolAsyncIterator=Symbol.asyncIterator,MappingAsyncIterator=(t,r)=>({[symbolAsyncIterator](){return this},async next(){const n=await t.next();if(n.done)return n;const e=r(n.value);return isPromise(e)?e.then(NextIteration):{value:e,done:!1}}}),isObject=t=>{if(null==t)return!1;const r=typeof t;return"object"==r||"function"==r},arrayMap=function(t,r){const n=t.length,e=Array(n);let o=-1,i=!1;for(;++o<n;){const n=r(t[o],o,t);isPromise(n)&&(i=!0),e[o]=n}return i?promiseAll(e):e},generatorFunctionMap=(t,r)=>function*(...n){for(const e of t(...n))yield r(e)},asyncGeneratorFunctionMap=function(t,r){return async function*(...n){for await(const e of t(...n))yield r(e)}},curry2ResolveArg0=(t,r)=>function(n){return t(n,r)},curry2ResolveArg1=(t,r)=>function(n){return t(r,n)},curry2=function(t,r,n){return r==__?curry2ResolveArg0(t,n):curry2ResolveArg1(t,r)},reducerMap=(t,r)=>function(n,e){const o=r(e);return isPromise(o)?o.then(curry2(t,n,__)):t(n,o)},callPropUnary=(t,r,n)=>t[r](n),stringMap=function(t,r){const n=arrayMap(t,r);return isPromise(n)?n.then(curry3(callPropUnary,__,"join","")):n.join("")},setMap=function(t,r){const n=new Set,e=[];for(const o of t){const i=r(o,o,t);isPromise(i)?e.push(i.then(curry3(callPropUnary,n,"add",__))):n.add(i)}return 0==e.length?n:promiseAll(e).then(always(n))},callPropBinary=(t,r,n,e)=>t[r](n,e),mapMap=function(t,r){const n=new Map,e=[];for(const[o,i]of t){const c=r(i,o,t);isPromise(c)?e.push(c.then(curry4(callPropBinary,n,"set",o,__))):n.set(o,c)}return 0==e.length?n:promiseAll(e).then(always(n))},promiseObjectAllExecutor=t=>function(r){const n={};let e=0;for(const o in t){const i=t[o];isPromise(i)?(e+=1,i.then((t=>function(o){n[t]=o,e-=1,0==e&&r(n)})(o))):n[o]=i}0==e&&r(n)},promiseObjectAll=t=>new Promise(promiseObjectAllExecutor(t)),objectMap=function(t,r){const n={};let e=!1;for(const o in t){const i=r(t[o],o,t);isPromise(i)&&(e=!0),n[o]=i}return e?promiseObjectAll(n):n},arrayMapSeriesAsync=async function(t,r,n,e){const o=t.length;for(;++e<o;){const o=r(t[e]);n[e]=isPromise(o)?await o:o}return n},arrayMapSeries=function(t,r){const n=t.length,e=Array(n);let o=-1;for(;++o<n;){const n=r(t[o]);if(isPromise(n))return n.then(funcConcat(curry3(objectSet,e,o,__),curry4(arrayMapSeriesAsync,t,r,__,o)));e[o]=n}return e},promiseRace=Promise.race.bind(Promise),arrayMapPoolAsync=async function(t,r,n,e,o,i){const c=t.length;for(;++o<c;){i.size>=n&&await promiseRace(i);const c=r(t[o]);if(isPromise(c)){const t=c.then(tapSync((()=>i.delete(t))));i.add(t),e[o]=t}else e[o]=c}return promiseAll(e)},arrayMapPool=function(t,r,n){const e=t.length,o=Array(e);let i=-1;for(;++i<e;){const e=r(t[i]);if(isPromise(e)){const c=new Set,s=e.then(tapSync((()=>c.delete(s))));return c.add(s),o[i]=s,arrayMapPoolAsync(t,r,n,o,i,c)}o[i]=e}return o},arrayMapWithIndex=function(t,r){const n=t.length,e=Array(n);let o=-1,i=!1;for(;++o<n;){const n=r(t[o],o,t);isPromise(n)&&(i=!0),e[o]=n}return i?promiseAll(e):e},hasOwnProperty=Object.prototype.hasOwnProperty,hasOwn=(t,r)=>hasOwnProperty.call(t,r),objectMapOwn=function(t,r){const n={};let e=!1;for(const o in t)if(hasOwn(t,o)){const i=r(t[o]);isPromise(i)&&(e=!0),n[o]=i}return e?promiseObjectAll(n):n},_curryArity=(t,r,n)=>function(...e){const o=n.length,i=e.length,c=[];let s=-1,u=-1,a=0;for(;++s<o;){const o=n[s];if(o==__&&(u+=1)<i){const t=e[u];t==__&&(a+=1),c.push(t)}else c.push(o);if(c.length==t)return 0==a?r(...c):curryArity(t,r,c)}for(;++u<i;){const n=e[u];if(n==__&&(a+=1),c.push(n),c.length==t)return 0==a?r(...c):curryArity(t,r,c)}return curryArity(t,r,c)},curryArity=function(t,r,n){const e=n.length;if(e<t)return _curryArity(t,r,n);let o=-1;for(;++o<e;){if(n[o]==__)return _curryArity(t,r,n)}return r(...n)},spread2=t=>function([r,n]){return t(r,n)},objectMapEntries=function(t,r){const n={},e=[];for(const o in t){const i=r([o,t[o]]);isPromise(i)?e.push(i.then(spread2(curryArity(3,objectSet,[n])))):n[i[0]]=i[1]}return 0==e.length?n:promiseAll(e).then(always(n))},mapSet=function(t,r,n){return t.set(r,n)},mapMapEntriesForEachCallback=(t,r,n)=>function(e,o){const i=t([o,e]);isPromise(i)?n.push(i.then(spread2(curryArity(3,mapSet,[r])))):r.set(i[0],i[1])},mapMapEntries=function(t,r){const n=new Map,e=[];return t.forEach(mapMapEntriesForEachCallback(r,n,e)),0==e.length?n:promiseAll(e).then(always(n))},map=t=>function(r){return isArray(r)?arrayMap(r,t):"function"==typeof r?isGeneratorFunction(r)?generatorFunctionMap(r,t):isAsyncGeneratorFunction(r)?asyncGeneratorFunctionMap(r,t):reducerMap(r,t):null==r?r:"function"==typeof r.then?r.then(t):"function"==typeof r.map?r.map(t):"string"==typeof r||r.constructor==String?stringMap(r,t):r.constructor==Set?setMap(r,t):r.constructor==Map?mapMap(r,t):"function"==typeof r[symbolIterator]?MappingIterator(r[symbolIterator](),t):"function"==typeof r[symbolAsyncIterator]?MappingAsyncIterator(r[symbolAsyncIterator](),t):r.constructor==Object?objectMap(r,t):t(r)};map.entries=function(t){return function(r){if(null==r)throw new TypeError("value is not an Object or Map");if(r.constructor==Object)return objectMapEntries(r,t);if(r.constructor==Map)return mapMapEntries(r,t);throw new TypeError("value is not an Object or Map")}},map.series=t=>function(r){if(isArray(r))return arrayMapSeries(r,t);throw new TypeError(`${r} is not an Array`)},map.pool=(t,r)=>function(n){if(isArray(n))return arrayMapPool(n,r,t);throw new TypeError(`${n} is not an Array`)},map.withIndex=t=>function(r){if(isArray(r))return arrayMapWithIndex(r,t);throw new TypeError(`${r} is not an Array`)},map.own=t=>function(r){if(isObject(r)&&!isArray(r))return objectMapOwn(r,t);throw new TypeError(`${r} is not an Object`)};const FilteringIterator=(t,r)=>({[symbolIterator](){return this},next(){let n=t.next();for(;!n.done;){const{value:e}=n;if(r(e))return{value:e,done:!1};n=t.next()}return n}}),FilteringAsyncIterator=(t,r)=>({isAsyncIteratorDone:!1,[symbolAsyncIterator](){return this},async next(){for(;!this.isAsyncIteratorDone;){const{value:n,done:e}=await t.next();if(e)this.isAsyncIteratorDone=!0;else{const t=r(n);if(isPromise(t)?await t:t)return{value:n,done:!1}}}return{value:void 0,done:!0}}}),arrayExtendMap=function(t,r,n,e){const o=r.length;let i=t.length-1;for(;++e<o;)t[++i]=n(r[e],e,t);return t},arrayFilterByConditions=function(t,r,n,e){const o=t.length;let i=-1;for(;++n<o;)e[++i]&&r.push(t[n]);return r},arrayFilter=function(t,r){const n=t.length,e=[];let o=-1,i=-1;for(;++o<n;){const n=t[o],c=r(n);if(isPromise(c))return promiseAll(arrayExtendMap([c],t,r,o)).then(curry4(arrayFilterByConditions,t,e,o-1,__));c&&(e[++i]=n)}return e},generatorFunctionFilter=(t,r)=>function*(...n){yield*FilteringIterator(t(...n),r)},asyncGeneratorFunctionFilter=(t,r)=>async function*(...n){yield*FilteringAsyncIterator(t(...n),r)},reducerFilter=(t,r)=>function(n,e){const o=r(e);return isPromise(o)?o.then(curry3(thunkConditional,__,thunkify2(t,n,e),always(n))):o?t(n,e):n},stringFilter=function(t,r){const n=arrayFilter(t,r);return isPromise(n)?n.then(curry3(callPropUnary,__,"join","")):n.join("")},thunkify1=(t,r)=>function(){return t(r)},setFilter=function(t,r){const n=new Set,e=n.add.bind(n),o=[];for(const i of t){const c=r(i,i,t);isPromise(c)?o.push(c.then(curry3(thunkConditional,__,thunkify1(e,i),noop))):c&&n.add(i)}return 0==o.length?n:promiseAll(o).then(always(n))},thunkify4=(t,r,n,e,o)=>function(){return t(r,n,e,o)},mapFilter=function(t,r){const n=new Map,e=[];for(const[o,i]of t){const c=r(i,o,t);isPromise(c)?e.push(c.then(curry3(thunkConditional,__,thunkify4(callPropBinary,n,"set",o,i),noop))):c&&n.set(o,i)}return 0==e.length?n:promiseAll(e).then(always(n))},objectSetIf=function(t,r,n,e){e&&(t[r]=n)},objectFilter=function(t,r){const n={},e=[];for(const o in t){const i=t[o],c=r(i,o,t);isPromise(c)?e.push(c.then(curry4(objectSetIf,n,o,t[o],__))):c&&(n[o]=i)}return 0==e.length?n:promiseAll(e).then(always(n))},arrayExtendMapWithIndex=function(t,r,n,e){const o=r.length;let i=t.length-1;for(;++e<o;)t[++i]=n(r[e],e,r);return t},arrayFilterWithIndex=function(t,r){const n=t.length,e=[];let o=-1,i=-1;for(;++o<n;){const n=t[o],c=r(n,o,t);if(isPromise(c))return promiseAll(arrayExtendMapWithIndex([c],t,r,o)).then(curry4(arrayFilterByConditions,t,e,o-1,__));c&&(e[++i]=n)}return e},filter=t=>function(r){return isArray(r)?arrayFilter(r,t):"function"==typeof r?isGeneratorFunction(r)?generatorFunctionFilter(r,t):isAsyncGeneratorFunction(r)?asyncGeneratorFunctionFilter(r,t):reducerFilter(r,t):null==r?r:"string"==typeof r||r.constructor==String?stringFilter(r,t):r.constructor==Set?setFilter(r,t):r.constructor==Map?mapFilter(r,t):"function"==typeof r.filter?r.filter(t):"function"==typeof r[symbolIterator]?FilteringIterator(r[symbolIterator](),t):"function"==typeof r[symbolAsyncIterator]?FilteringAsyncIterator(r[symbolAsyncIterator](),t):r.constructor==Object?objectFilter(r,t):r};filter.withIndex=t=>function(r){if(isArray(r))return arrayFilterWithIndex(r,t);throw new TypeError(`${r} is not an Array`)};const curryArgs3ResolveArgs0=(t,r,n)=>function(...e){return t(e,r,n)},curryArgs3ResolveArgs1=(t,r,n)=>function(...e){return t(r,e,n)},curryArgs3ResolveArgs2=(t,r,n)=>function(...e){return t(r,n,e)},curryArgs3=function(t,r,n,e){return r==__?curryArgs3ResolveArgs0(t,n,e):n==__?curryArgs3ResolveArgs1(t,r,e):curryArgs3ResolveArgs2(t,r,n)},objectValues=Object.values,iteratorReduceAsync=async function(t,r,n){let e=t.next();if(e.done)return n;for(;!e.done;)n=r(n,e.value),isPromise(n)&&(n=await n),e=t.next();return n},iteratorReduce=function(t,r,n){let e=t.next();if(e.done)return n;for(void 0===n&&(n=e.value,e=t.next());!e.done;){if(n=r(n,e.value),isPromise(n))return n.then(curry3(iteratorReduceAsync,t,r,__));e=t.next()}return n},asyncIteratorReduce=async function(t,r,n){let e=await t.next();if(e.done)return n;for(void 0===n&&(n=e.value,e=await t.next());!e.done;)n=await r(n,e.value),e=await t.next();return n},arrayReduceAsync=async function(t,r,n,e){const o=t.length;for(;++e<o;)n=r(n,t[e],e,t),isPromise(n)&&(n=await n);return n},arrayReduce=function(t,r,n){const e=t.length;let o=-1;for(void 0===n&&(n=t[++o]);++o<e;)if(n=r(n,t[o],o,t),isPromise(n))return n.then(curry4(arrayReduceAsync,t,r,__,o));return n},curry5ResolveArg0=(t,r,n,e,o)=>function(i){return t(i,r,n,e,o)},curry5ResolveArg1=(t,r,n,e,o)=>function(i){return t(r,i,n,e,o)},curry5ResolveArg2=(t,r,n,e,o)=>function(i){return t(r,n,i,e,o)},curry5ResolveArg3=(t,r,n,e,o)=>function(i){return t(r,n,e,i,o)},curry5ResolveArg4=(t,r,n,e,o)=>function(i){return t(r,n,e,o,i)},curry5=function(t,r,n,e,o,i){return r==__?curry5ResolveArg0(t,n,e,o,i):n==__?curry5ResolveArg1(t,r,e,o,i):e==__?curry5ResolveArg2(t,r,n,o,i):o==__?curry5ResolveArg3(t,r,n,e,i):curry5ResolveArg4(t,r,n,e,o)},objectKeys=Object.keys,objectGetFirstKey=function(t){for(const r in t)return r},objectReduceAsync=async function(t,r,n,e,o){const i=e.length;for(;++o<i;){const i=e[o];n=r(n,t[i],i,t),isPromise(n)&&(n=await n)}return n},objectReduce=function(t,r,n){const e=objectKeys(t),o=e.length;let i=-1;for(void 0===n&&(n=t[e[++i]]);++i<o;){const o=e[i];if(n=r(n,t[o],o,t),isPromise(n))return n.then((c=objectReduceAsync,u=r,a=__,l=e,f=i,(s=t)==__?curry5ResolveArg0(c,u,a,l,f):u==__?curry5ResolveArg1(c,s,a,l,f):a==__?curry5ResolveArg2(c,s,u,l,f):l==__?curry5ResolveArg3(c,s,u,a,f):curry5ResolveArg4(c,s,u,a,l)))}var c,s,u,a,l,f;return n},mapReduceAsync=async function(t,r,n,e){for(const[o,i]of e)n=r(n,i,o,t),isPromise(n)&&(n=await n);return n},mapReduce=function(t,r,n){const e=t.entries();if(void 0===n){const t=e.next();if(t.done)return n;n=t.value[1]}for(const[o,i]of e)if(n=r(n,i,o,t),isPromise(n))return n.then(curry4(mapReduceAsync,t,r,__,e));return n},generatorFunctionReduce=(t,r,n)=>funcConcatSync(t,curry3(iteratorReduce,__,r,n)),asyncGeneratorFunctionReduce=(t,r,n)=>funcConcatSync(t,curry3(asyncIteratorReduce,__,r,n)),reducerConcat=(t,r)=>function(n,e){const o=t(n,e);return isPromise(o)?o.then(curry2(r,__,e)):r(o,e)},genericReduce=function(t,r,n){const e=t[0];return isArray(e)?arrayReduce(e,r,n):"function"==typeof e?isGeneratorFunction(e)?generatorFunctionReduce(e,r,n):isAsyncGeneratorFunction(e)?asyncGeneratorFunctionReduce(e,r,n):curryArgs3(genericReduce,__,1==t.length?reducerConcat(r,e):t.reduce(reducerConcat,r),n):null==e?void 0===n?curry2(r,e,__):r(n,e):e.constructor==Map?mapReduce(e,r,n):"function"==typeof e[symbolIterator]?iteratorReduce(e[symbolIterator](),r,n):"function"==typeof e[symbolAsyncIterator]?asyncIteratorReduce(e[symbolAsyncIterator](),r,n):"function"==typeof e.reduce?e.reduce(r,n):"function"==typeof e.chain?e.chain(curry2(r,n,__)):"function"==typeof e.flatMap?e.flatMap(curry2(r,n,__)):e.constructor==Object?objectReduce(e,r,n):void 0===n?curry2(r,e,__):r(n,e)},reduce=function(t,r){return"function"==typeof r?function(...n){const e=r(...n);return isPromise(e)?e.then(curry3(genericReduce,n,t,__)):genericReduce(n,t,e)}:curryArgs3(genericReduce,__,t,r)},isBinary=ArrayBuffer.isView,add=(t,r)=>t+r,isArrayLike=function(t){return null!=t&&t.length>0},_arrayExtend=function(t,r){const n=t.length,e=r.length;let o=-1;for(;++o<e;)t[n+o]=r[o];return t},arrayExtend=function(t,r){return null!=(n=r)&&n.length>0?_arrayExtend(t,r):(t.push(r),t);var n},globalThisHasBuffer="function"==typeof Buffer,bufferAlloc=globalThisHasBuffer?Buffer.alloc:noop,_binaryExtend=function(t,r){const n=t.length,e=globalThisHasBuffer&&t.constructor==Buffer?bufferAlloc(n+r.length):new t.constructor(n+r.length);return e.set(t),e.set(r,n),e},binaryExtend=function(t,r){return isArray(r)||isBinary(r)?_binaryExtend(t,r):_binaryExtend(t,[r])},isNodeReadStream=t=>null!=t&&"function"==typeof t.pipe,__streamWrite=t=>function(r,n,e){return t.write(r,n,e),t},_streamExtendExecutor=(t,r)=>function(n,e){r.on("data",__streamWrite(t)),r.on("end",thunkify1(n,t)),r.on("error",e)},_streamExtend=(t,r)=>new Promise(_streamExtendExecutor(t,r)),streamExtend=function(t,r){return null!=(n=r)&&"function"==typeof n.pipe?_streamExtend(t,r):(t.write(r),t);var n},setExtend=function(t,r){if(null!=r&&r.constructor==Set){for(const n of r)t.add(n);return t}return t.add(r)},callConcat=function(t,r){return t.concat(r)},identityTransform=function(t,r,n){const e=genericReduce(t,r(noop),null);return isPromise(e)?e.then(always(n)):n},genericTransform=function(t,r,n){if(isArray(n))return genericReduce(t,r(arrayExtend),n);if(isBinary(n)){const e=genericReduce(t,r(arrayExtend),[]);return isPromise(e)?e.then(curry2(binaryExtend,n,__)):binaryExtend(n,e)}if(null==n)return identityTransform(t,r,n);const e=n.constructor;return"string"==typeof n||e==String?genericReduce(t,r(add),n):"function"==typeof n.concat?genericReduce(t,r(callConcat),n):"function"==typeof n.write?genericReduce(t,r(streamExtend),n):e==Set?genericReduce(t,r(setExtend),n):e==Object?genericReduce(t,r(objectAssign),n):identityTransform(t,r,n)},transform=function(t,r){return"function"==typeof r?function(...n){const e=r(...n);return isPromise(e)?e.then(curry3(genericTransform,n,t,__)):genericTransform(n,t,e)}:function(...n){return genericTransform(n,t,r)}},arrayPush=function(t,r){return t.push(r),t},FlatMappingIterator=function(t,r){let n=[],e=0;return{[symbolIterator](){return this},next(){if(e<n.length){const t=n[e];return e+=1,{value:t,done:!1}}const o=t.next();if(o.done)return o;const i=genericReduce([r(o.value)],arrayPush,[]);return i.length>1&&(n=i,e=1),{value:i[0],done:!1}}}},sleep=t=>new Promise((r=>{setTimeout(r,t)})),FlatMappingAsyncIterator=function(t,r){const n=[],e=new Set;return{isAsyncIteratorDone:!1,[symbolAsyncIterator](){return this},toString:()=>"[object FlatMappingAsyncIterator]",async next(){for(;!this.isAsyncIteratorDone||n.length>0||e.size>0;){if(!this.isAsyncIteratorDone){const{value:o,done:i}=await t.next();if(i)this.isAsyncIteratorDone=i;else{const t=r(o);if(isPromise(t)){const r=t.then(curryArgs3(genericReduce,__,arrayPush,n)).then((()=>e.delete(r)));e.add(r)}else{const r=genericReduce([t],arrayPush,n);if(isPromise(r)){const t=r.then((()=>e.delete(t)));e.add(t)}}}}if(n.length>0)return{value:n.shift(),done:!1};e.size>0&&await promiseRace([sleep(1e3),...e])}return{value:void 0,done:!0}}}},getArg1=(t,r)=>r,identity=t=>t,asyncIteratorForEach=async function(t,r){const n=[];for await(const e of t){const t=r(e);isPromise(t)&&n.push(t)}return 0==n.length?t:promiseAll(n).then(always(t))},arrayFlatten=function(t){const r=t.length,n=[],e=[];let o=-1;for(;++o<r;){const r=t[o];if(isArray(r)){const t=r.length;let n=-1;for(;++n<t;)e.push(r[n])}else if(null==r)e.push(r);else if("function"==typeof r.then)n.push(r.then(curry2(arrayPush,e,__)));else if("function"==typeof r[symbolIterator])for(const t of r)e.push(t);else if("function"==typeof r[symbolAsyncIterator])n.push(asyncIteratorForEach(r[symbolAsyncIterator](),curry2(arrayPush,e,__)));else if("function"==typeof r.chain){const t=r.chain(identity);isPromise(t)?n.push(t.then(curry2(arrayPush,e,__))):e.push(t)}else if("function"==typeof r.flatMap){const t=r.flatMap(identity);isPromise(t)?n.push(t.then(curry2(arrayPush,e,__))):e.push(t)}else if("function"==typeof r.reduce){const t=r.reduce(funcConcatSync(getArg1,curry2(arrayPush,e,__)),null);isPromise(t)&&n.push(t)}else if(r.constructor==Object)for(const t in r)e.push(r[t]);else e.push(r)}return 0==n.length?e:promiseAll(n).then(always(e))},arrayFlatMap=function(t,r){const n=arrayMap(t,r);return isPromise(n)?n.then(arrayFlatten):arrayFlatten(n)},objectFlatten=function(t){const r=[],n={},e=curry2(objectAssign,n,__),o=funcConcatSync(getArg1,e);for(const i in t){const c=t[i];if(null!=c)if("function"==typeof c[symbolIterator])for(const t of c)objectAssign(n,t);else if("function"==typeof c[symbolAsyncIterator])r.push(asyncIteratorForEach(c[symbolAsyncIterator](),e));else if("function"==typeof c.chain){const t=c.chain(identity);isPromise(t)?r.push(t.then(e)):objectAssign(n,t)}else if("function"==typeof c.flatMap){const t=c.flatMap(identity);isPromise(t)?r.push(t.then(e)):e(t)}else if("function"==typeof c.reduce){const t=c.reduce(o,null);isPromise(t)&&r.push(t)}else objectAssign(n,c)}return 0==r.length?n:promiseAll(r).then((()=>n))},objectFlatMap=function(t,r){const n=objectMap(t,r);return isPromise(n)?n.then(objectFlatten):objectFlatten(n)},setFlatten=function(t){t.size;const r=[],n=new Set,e=(t,r)=>n.add(r),o=curry3(callPropUnary,n,"add",__);for(const i of t)if(isArray(i)){const t=i.length;let r=-1;for(;++r<t;)n.add(i[r])}else if(null==i)n.add(i);else if("function"==typeof i[symbolIterator])for(const t of i)n.add(t);else if("function"==typeof i[symbolAsyncIterator])r.push(asyncIteratorForEach(i[symbolAsyncIterator](),o));else if("function"==typeof i.chain){const t=i.chain(identity);isPromise(t)?r.push(t.then(o)):n.add(t)}else if("function"==typeof i.flatMap){const t=i.flatMap(identity);isPromise(t)?r.push(t.then(o)):n.add(t)}else if("function"==typeof i.reduce){const t=i.reduce(e,null);isPromise(t)&&r.push(t)}else if(i.constructor==Object)for(const t in i)n.add(i[t]);else n.add(i);return 0==r.length?n:promiseAll(r).then((()=>n))},setFlatMap=function(t,r){const n=setMap(t,r);return isPromise(n)?n.then(setFlatten):setFlatten(n)},arrayJoin=(t,r)=>t.join(r),arrayFlattenToString=funcConcat(arrayFlatten,curry2(arrayJoin,__,"")),stringFlatMap=function(t,r){const n=arrayMap(t,r);return isPromise(n)?n.then(arrayFlattenToString):arrayFlattenToString(n)},streamWrite=function(t,r,n,e){return t.write(r,n,e),t},streamFlatExtend=async function(t,r){const n=curry2(streamWrite,t,__),e=funcConcatSync(getArg1,n),o=[];if(isArray(r)){const n=r.length;let e=-1;for(;++e<n;)t.write(r[e])}else if(null==r)t.write(r);else if("function"==typeof r[symbolIterator])for(const n of r)t.write(n);else if("function"==typeof r[symbolAsyncIterator])o.push(asyncIteratorForEach(r[symbolAsyncIterator](),n));else if("function"==typeof r.chain){const e=r.chain(identity);isPromise(e)?o.push(e.then(n)):t.write(e)}else if("function"==typeof r.flatMap){const e=r.flatMap(identity);isPromise(e)?o.push(e.then(n)):t.write(e)}else if("function"==typeof r.reduce){const t=r.reduce(e,null);isPromise(t)&&o.push(t)}else if(r.constructor==Object)for(const n in r)t.write(r[n]);else t.write(r);return 0==o.length?t:promiseAll(o).then(always(t))},streamFlatMap=async function(t,r){const n=new Set;for await(const e of t){const o=r(e);if(isPromise(o)){const r=o.then(curry2(streamFlatExtend,t,__)).then((()=>n.delete(r)));n.add(r)}else{const r=streamFlatExtend(t,o);if(isPromise(r)){const t=r.then((()=>n.delete(t)));n.add(t)}}}return await promiseAll(n),t},arrayJoinToBinary=function(t,r){const n=t.length;let e=-1,o=r;for(;++e<n;)o=binaryExtend(o,t[e]);return o},arrayFlattenToBinary=function(t,r){const n=arrayFlatten(t);return isPromise(n)?n.then(curry2(arrayJoinToBinary,__,r)):arrayJoinToBinary(n,r)},binaryFlatMap=function(t,r){const n=arrayMap(t,r),e=globalThisHasBuffer&&t.constructor==Buffer?bufferAlloc(0):new t.constructor(0);return isPromise(n)?n.then(curry2(arrayFlattenToBinary,__,e)):arrayFlattenToBinary(n,e)},reducerFlatMap=(t,r)=>function(n,e){const o=r(e);return isPromise(o)?o.then(curryArgs3(genericReduce,__,t,n)):genericReduce([o],t,n)},generatorFunctionFlatMap=(t,r)=>function*(...n){yield*FlatMappingIterator(t(...n),r)},asyncGeneratorFunctionFlatMap=(t,r)=>async function*(...n){yield*FlatMappingAsyncIterator(t(...n),r)},flatMap=t=>function(r){if(isArray(r))return arrayFlatMap(r,t);if("function"==typeof r)return isGeneratorFunction(r)?generatorFunctionFlatMap(r,t):isAsyncGeneratorFunction(r)?asyncGeneratorFunctionFlatMap(r,t):reducerFlatMap(r,t);if(isBinary(r))return binaryFlatMap(r,t);if(null==r)return t(r);if("function"==typeof r.then)return r.then(t);if("function"==typeof r.next)return symbolIterator in r?FlatMappingIterator(r,t):FlatMappingAsyncIterator(r,t);if("function"==typeof r.chain)return r.chain(t);if("function"==typeof r.flatMap)return r.flatMap(t);if("function"==typeof r[symbolAsyncIterator]&&"function"==typeof r.write)return streamFlatMap(r,t);const n=r.constructor;return n==Object?objectFlatMap(r,t):n==Set?setFlatMap(r,t):"string"==typeof r||n==String?stringFlatMap(r,t):t(r)},SelfReferencingPromise=function(t){const r=t.then((t=>[t,r]));return r},asyncArrayAny=async function(t,r,n,e){const o=t.length;for(;++n<o;){const o=r(t[n]);if(isPromise(o))e.add(SelfReferencingPromise(o));else if(o)return!0}for(;e.size>0;){const[t,r]=await promiseRace(e);if(e.delete(r),t)return!0}return!1},arrayAny=function(t,r){const n=t.length;let e=-1;for(;++e<n;){const n=r(t[e]);if(isPromise(n))return asyncArrayAny(t,r,e,new Set([SelfReferencingPromise(n)]));if(n)return!0}return!1},asyncIteratorAny=async function(t,r,n,e=20){let o=t.next();for(isPromise(o)&&(o=await o);!o.done;){if(n.size>=e){const[t,r]=await promiseRace(n);if(n.delete(r),t)return!0}const i=r(o.value);if(isPromise(i))n.add(SelfReferencingPromise(i));else if(i)return!0;o=t.next(),isPromise(o)&&(o=await o)}for(;n.size>0;){const[t,r]=await promiseRace(n);if(n.delete(r),t)return!0}return!1},iteratorAny=function(t,r){for(const n of t){const e=r(n);if(isPromise(e))return asyncIteratorAny(t,r,new Set([SelfReferencingPromise(e)]));if(e)return!0}return!1},reducerAnySync=t=>function(r,n){return!!r||t(n)},reducerAny=t=>function(r,n){return!0===r?r:isPromise(r)?r.then(curry2(reducerAnySync(t),__,n)):!!r||t(n)},any=t=>function(r){return isArray(r)?arrayAny(r,t):null==r?t(r):"function"==typeof r[symbolIterator]?iteratorAny(r[symbolIterator](),t):"function"==typeof r[symbolAsyncIterator]?asyncIteratorAny(r[symbolAsyncIterator](),t,new Set):"function"==typeof r.reduce?r.reduce(reducerAny(t),!1):r.constructor==Object?arrayAny(objectValues(r),t):t(r)},arrayAll=function(t,r){const n=t.length,e=[];let o=-1;for(;++o<n;){const n=r(t[o]);if(isPromise(n))e.push(n);else if(!n)return!1}return 0==e.length||promiseAll(e).then(curry3(callPropUnary,__,"every",Boolean))},iteratorAll=function(t,r){const n=[];for(const e of t){const t=r(e);if(isPromise(t))n.push(t);else if(!t)return!1}return 0==n.length||promiseAll(n).then(curry3(callPropUnary,__,"every",Boolean))},asyncIteratorAll=async function(t,r,n,e=20){let o=await t.next();for(;!o.done;){if(n.size>=e){const[t,r]=await promiseRace(n);if(n.delete(r),!t)return!1}const i=r(o.value);if(isPromise(i))n.add(SelfReferencingPromise(i));else if(!i)return!1;o=await t.next()}for(;n.size>0;){const[t,r]=await promiseRace(n);if(n.delete(r),!t)return!1}return!0},reducerAllSync=(t,r,n)=>!!r&&t(n),reducerAll=t=>function(r,n){return!1!==r&&(isPromise(r)?r.then(curry3(reducerAllSync,t,__,n)):!!r&&t(n))},all=t=>function(r){return isArray(r)?arrayAll(r,t):null==r?t(r):"function"==typeof r[symbolIterator]?iteratorAll(r[symbolIterator](),t):"function"==typeof r[symbolAsyncIterator]?asyncIteratorAll(r[symbolAsyncIterator](),t,new Set):"function"==typeof r.reduce?r.reduce(reducerAll(t),!0):r.constructor==Object?arrayAll(objectValues(r),t):t(r)},areAllNonfunctionsTruthy=function(t,r){const n=t.length;for(;++r<n;){let n=t[r];if(isPromise(n))return n.then(curry3(thunkConditional,__,thunkify2(areAllNonfunctionsTruthy,t,r),always(!1)));if(!n)return!1}return!0},asyncArePredicatesAllTruthy=async function(t,r,n){const e=t.length;for(;++n<e;){let e=t[n];if("function"==typeof e&&(e=e(r)),isPromise(e)&&(e=await e),!e)return!1}return!0},and=t=>areAllValuesNonfunctions(t)?areAllNonfunctionsTruthy(t,-1):function(r){const n=t.length;let e=-1;for(;++e<n;){let n=t[e];if("function"==typeof n&&(n=n(r)),isPromise(n))return n.then(curry3(thunkConditional,__,thunkify3(asyncArePredicatesAllTruthy,t,r,e),always(!1)));if(!n)return!1}return!0},areAnyNonfunctionsTruthy=function(t,r){const n=t.length;for(;++r<n;){let n=t[r];if(isPromise(n))return n.then(curry3(thunkConditional,__,always(!0),thunkify2(areAnyNonfunctionsTruthy,t,r)));if(n)return!0}return!1},asyncAreAnyPredicatesTruthy=async function(t,r,n){const e=t.length;for(;++n<e;){let e=t[n];if("function"==typeof e&&(e=e(r)),console.log("hey - or",e),isPromise(e)&&(e=await e),e)return!0}return!1},or=t=>areAllValuesNonfunctions(t)?areAnyNonfunctionsTruthy(t,-1):function(r){const n=t.length;let e=-1;for(;++e<n;){let n=t[e];if("function"==typeof n&&(n=n(r)),isPromise(n))return n.then(curry3(thunkConditional,__,always(!0),thunkify3(asyncAreAnyPredicatesTruthy,t,r,e)));if(n)return!0}return!1},_not=t=>!t,not=function(t){return"function"==typeof t?function(r){const n=t(r);return isPromise(n)?n.then(_not):!n}:!t},notSync=t=>function(...r){return!t(...r)};not.sync=notSync;const sameValueZero=function(t,r){return t===r||t!=t&&r!=r},eq=function(t,r){const n="function"==typeof t,e="function"==typeof r;return n&&e?function(n){const e=t(n),o=r(n),i=isPromise(e),c=isPromise(o);return i&&c?promiseAll([e,o]).then(spread2(sameValueZero)):i?e.then(curry2(sameValueZero,__,o)):c?o.then(curry2(sameValueZero,e,__)):sameValueZero(e,o)}:n?function(n){const e=t(n);return isPromise(e)?e.then(curry2(sameValueZero,__,r)):sameValueZero(e,r)}:e?function(n){const e=r(n);return isPromise(e)?e.then(curry2(sameValueZero,t,__)):sameValueZero(t,e)}:sameValueZero(t,r)},greaterThan=(t,r)=>t>r,gt=function(t,r){const n="function"==typeof t,e="function"==typeof r;return n&&e?function(n){const e=t(n),o=r(n),i=isPromise(e),c=isPromise(o);return i&&c?promiseAll([e,o]).then(spread2(greaterThan)):i?e.then(curry2(greaterThan,__,o)):c?o.then(curry2(greaterThan,e,__)):e>o}:n?function(n){const e=t(n);return isPromise(e)?e.then(curry2(greaterThan,__,r)):e>r}:e?function(n){const e=r(n);return isPromise(e)?e.then(curry2(greaterThan,t,__)):t>e}:t>r},lessThan=(t,r)=>t<r,lt=function(t,r){const n="function"==typeof t,e="function"==typeof r;return n&&e?function(n){const e=t(n),o=r(n),i=isPromise(e),c=isPromise(o);return i&&c?promiseAll([e,o]).then(spread2(lessThan)):i?e.then(curry2(lessThan,__,o)):c?o.then(curry2(lessThan,e,__)):e<o}:n?function(n){const e=t(n);return isPromise(e)?e.then(curry2(lessThan,__,r)):e<r}:e?function(n){const e=r(n);return isPromise(e)?e.then(curry2(lessThan,t,__)):t<e}:t<r},greaterThanOrEqual=(t,r)=>t>=r,gte=function(t,r){const n="function"==typeof t,e="function"==typeof r;return n&&e?function(n){const e=t(n),o=r(n),i=isPromise(e),c=isPromise(o);return i&&c?promiseAll([e,o]).then(spread2(greaterThanOrEqual)):i?e.then(curry2(greaterThanOrEqual,__,o)):c?o.then(curry2(greaterThanOrEqual,e,__)):e>=o}:n?function(n){const e=t(n);return isPromise(e)?e.then(curry2(greaterThanOrEqual,__,r)):e>=r}:e?function(n){const e=r(n);return isPromise(e)?e.then(curry2(greaterThanOrEqual,t,__)):t>=e}:t>=r},lessThanOrEqual=(t,r)=>t<=r,lte=function(t,r){const n="function"==typeof t,e="function"==typeof r;return n&&e?function(n){const e=t(n),o=r(n),i=isPromise(e),c=isPromise(o);return i&&c?promiseAll([e,o]).then(spread2(lessThanOrEqual)):i?e.then(curry2(lessThanOrEqual,__,o)):c?o.then(curry2(lessThanOrEqual,e,__)):e<=o}:n?function(n){const e=t(n);return isPromise(e)?e.then(curry2(lessThanOrEqual,__,r)):e<=r}:e?function(n){const e=r(n);return isPromise(e)?e.then(curry2(lessThanOrEqual,t,__)):t<=e}:t<=r},memoizeCappedUnary=function(t,r){const n=new Map,e=function(e){if(n.has(e))return n.get(e);const o=t(e);return n.set(e,o),n.size>r&&n.clear(),o};return e.cache=n,e},pathDelimiters=/[.|[|\]]+/,parsePropertyPath=function(t){const r=t.length-1,n="["==t[0],e="]"==t[r];return n&&e?t.slice(1,r).split(pathDelimiters):n?t.slice(1).split(pathDelimiters):e?t.slice(0,r).split(pathDelimiters):t.split(pathDelimiters)},memoizedCappedParsePropertyPath=memoizeCappedUnary(parsePropertyPath,500),propertyPathToArray=t=>isArray(t)?t:"string"==typeof t?memoizedCappedParsePropertyPath(t):[t],getByPath=function(t,r){const n=propertyPathToArray(r),e=n.length;let o=-1,i=t;for(;++o<e;)if(i=i[n[o]],null==i)return;return i},get=(t,r)=>function(n){const e=null==n?void 0:getByPath(n,t);return void 0===e?"function"==typeof r?r(n):r:e},setByPath=function(t,r,n){if(!isObject(t))return t;const e=propertyPathToArray(n),o=e.length,i=o-1,c={...t};let s=c,u=-1;for(;++u<o;){const t=e[u];if(u==i)s[t]=r;else{const r=s[t],n=isArray(r)?r.slice():{...r};s[t]=n,s=n}}return c},set=(t,r)=>function(n){return setByPath(n,r,t)},pick=t=>function(r){if(null==r)return r;const n=t.length;let e={},o=-1;for(;++o<n;){const n=t[o],i=getByPath(r,n);null!=i&&(e=setByPath(e,i,n))}return e},deleteByPath=function(t,r){if(null==t)return;const n=propertyPathToArray(r),e=n.length-1;let o=-1,i=t;for(;++o<e;)if(i=i[n[o]],null==i)return;const c=n[o];null!=i&&c in i&&delete i[c]},objectCopyDeep=function(t){const r={};for(const n in t){const e=t[n];isArray(e)?r[n]=arrayCopyDeep(e):null!=e&&e.constructor==Object?r[n]=objectCopyDeep(e):r[n]=e}return r},arrayCopyDeep=function(t){const r=t.length,n=[];let e=-1;for(;++e<r;){const r=t[e];isArray(r)?n[e]=arrayCopyDeep(r):null!=r&&r.constructor==Object?n[e]=objectCopyDeep(r):n[e]=r}return n},copyDeep=function(t){return isArray(t)?arrayCopyDeep(t):null==t?t:t.constructor==Object?objectCopyDeep(t):t},omit=t=>function(r){const n=t.length,e=isArray(o=r)?arrayCopyDeep(o):null==o?o:o.constructor==Object?objectCopyDeep(o):o;var o;let i=-1;for(;++i<n;)deleteByPath(e,t[i]);return e},thunkify=(t,...r)=>function(){return t(...r)},curry=(t,...r)=>curryArity(t.length,t,r);curry.arity=function(t,r,...n){return curryArity(t,r,n)};const rubico={pipe:pipe,tap:tap,switchCase:switchCase,tryCatch:tryCatch,fork:fork,assign:assign,get:get,set:set,pick:pick,omit:omit,map:map,filter:filter,reduce:reduce,transform:transform,flatMap:flatMap,and:and,or:or,not:not,any:any,all:all,eq:eq,gt:gt,lt:lt,gte:gte,lte:lte,thunkify:thunkify,always:always,curry:curry,__:__};export{pipe,tap,switchCase,tryCatch,fork,assign,get,set,pick,omit,map,filter,reduce,transform,flatMap,and,or,not,any,all,eq,gt,lt,gte,lte,thunkify,always,curry,__};export default rubico;
